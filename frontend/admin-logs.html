<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>系統操作日誌 - 小跑豬後台</title>
    <link rel="icon" href="assets/logo.png" type="image/png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="css/admin-modern.css" />
    <link rel="stylesheet" href="css/modals-unified.css" />
    <style>
      .log-details {
        font-size: 0.85rem;
        color: #666;
        max-width: 400px;
        word-break: break-all;
      }
      .action-tag {
        padding: 4px 10px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        display: inline-block;
        white-space: nowrap;
      }
      /* 視覺化配色方案 */
      .tag-red {
        background: #ffebee;
        color: #b71c1c;
        border: 1px solid #ffcdd2;
      }
      .tag-green {
        background: #e8f5e9;
        color: #1b5e20;
        border: 1px solid #81c784;
      }
      .tag-orange {
        background: #fff3e0;
        color: #e65100;
        border: 1px solid #ffb74d;
      }
      .tag-blue {
        background: #e3f2fd;
        color: #0d47a1;
        border: 1px solid #64b5f6;
      }
      .tag-dark {
        background: #f5f5f5;
        color: #333;
        border: 1px solid #ddd;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <h1 class="page-title"><i class="fas fa-history"></i> 系統操作日誌</h1>

      <div class="card mb-3">
        <div class="card-body">
          <div
            class="filters-bar"
            style="
              display: flex;
              gap: 10px;
              flex-wrap: wrap;
              align-items: center;
            "
          >
            <div style="flex: 1; min-width: 250px">
              <input
                type="text"
                id="search-input"
                class="form-control"
                placeholder="搜尋管理員 Email 或 備註細節..."
              />
            </div>
            <div style="flex: 0 0 240px">
              <select id="action-filter" class="form-control">
                <option value="">所有動作類型</option>
                <optgroup label="📦 包裹管理">
                  <option value="CREATE_PACKAGE">建立包裹/手動入庫</option>
                  <option value="ADMIN_CREATE_PACKAGE">管理員代客預報</option>
                  <option value="UPDATE_PACKAGE">修改包裹內容</option>
                  <option value="UPDATE_PACKAGE_STATUS">變更包裹狀態</option>
                  <option value="UPDATE_PACKAGE_DETAILS">
                    更新測量數據(含改價)
                  </option>
                  <option value="DELETE_PACKAGE">刪除包裹紀錄</option>
                  <option value="ADMIN_DELETE_PACKAGE">管理員刪除包裹</option>
                  <option value="CLAIM_PACKAGE">認領無主包裹</option>
                  <option value="BULK_FORECAST">批量預報包裹</option>
                  <option value="BULK_UPDATE_PACKAGE_STATUS">
                    批量修改包裹狀態
                  </option>
                  <option value="BULK_DELETE_PACKAGES">批量刪除多筆包裹</option>
                  <option value="RESOLVE_EXCEPTION">回覆異常包裹處理</option>
                </optgroup>
                <optgroup label="🚚 集運訂單">
                  <option value="CREATE_SHIPMENT">手動建立集運單</option>
                  <option value="UPDATE_SHIPMENT">變更集運狀態</option>
                  <option value="UPDATE_SHIPMENT_STATUS">修改物流狀態</option>
                  <option value="ADJUST_PRICE">管理員人工改價</option>
                  <option value="ADJUST_SHIPMENT_PRICE">
                    訂單金額調整操作
                  </option>
                  <option value="REJECT_SHIPMENT">駁回集運申請</option>
                  <option value="RETURN_SHIPMENT">退回/駁回集運單</option>
                  <option value="DELETE_SHIPMENT">永久刪除集運紀錄</option>
                  <option value="ADMIN_DELETE_SHIPMENT">
                    管理員刪除集運單
                  </option>
                  <option value="BULK_UPDATE_SHIPMENT_STATUS">
                    批量更新訂單狀態
                  </option>
                  <option value="BULK_DELETE_SHIPMENTS">
                    批量刪除多筆訂單
                  </option>
                  <option value="CREATE_INVOICE">系統自動開立發票</option>
                  <option value="INVOICE_ISSUE">手動開立電子發票</option>
                  <option value="INVOICE_VOID">作廢電子發票</option>
                </optgroup>
                <optgroup label="🛋️ 傢俱代採購">
                  <option value="CREATE_FURNITURE_ORDER">
                    提交傢俱代購申請
                  </option>
                  <option value="UPDATE_FURNITURE_ORDER">
                    修改代購訂單狀態
                  </option>
                  <option value="DELETE_FURNITURE_ORDER">
                    刪除傢俱代購紀錄
                  </option>
                  <option value="BULK_UPDATE_FURNITURE">
                    批量更新傢俱狀態
                  </option>
                  <option value="BULK_DELETE_FURNITURE">
                    批量刪除傢俱紀錄
                  </option>
                </optgroup>
                <optgroup label="💰 財務與發票">
                  <option value="WALLET_DEPOSIT_REQUEST">提交儲值申請</option>
                  <option value="APPROVE_DEPOSIT">通過儲值審核</option>
                  <option value="REJECT_DEPOSIT">駁回儲值申請</option>
                  <option value="APPROVE_TRANSACTION">通過交易審核</option>
                  <option value="REJECT_TRANSACTION">駁回交易申請</option>
                  <option value="REVIEW_TRANSACTION">審核財務交易紀錄</option>
                  <option value="ADJUST_BALANCE">調整會員錢包餘額</option>
                  <option value="MANUAL_ADJUST">管理員手動調整餘額</option>
                  <option value="MANUAL_ISSUE_INVOICE">補開集運發票</option>
                  <option value="MANUAL_VOID_INVOICE">管理員手動廢票</option>
                  <option value="MANUAL_ISSUE_DEPOSIT_INVOICE">
                    開立儲值手續費發票
                  </option>
                  <option value="MANUAL_INVOICE_DEPOSIT">
                    補開儲值手續費發票
                  </option>
                </optgroup>
                <optgroup label="🛡️ 會員與安全性">
                  <option value="LOGIN">管理後台登入成功</option>
                  <option value="REGISTER">新會員註冊紀錄</option>
                  <option value="USER_REGISTER">新會員註冊(系統)</option>
                  <option value="CREATE_STAFF">建立後台工作人員</option>
                  <option value="CREATE_STAFF_USER">新增管理團隊成員</option>
                  <option value="UPDATE_USER_STATUS">停用/啟用會員帳號</option>
                  <option value="TOGGLE_USER">變更帳號狀態(停用/啟用)</option>
                  <option value="TOGGLE_USER_STATUS">變更帳號活動狀態</option>
                  <option value="UPDATE_USER_PROFILE">
                    管理員修改用戶個資
                  </option>
                  <option value="ADMIN_UPDATE_PROFILE">
                    管理員強制修改個資
                  </option>
                  <option value="UPDATE_USER_PERMISSIONS">
                    變更管理操作權限
                  </option>
                  <option value="UPDATE_PERMS">修改管理帳號權限</option>
                  <option value="UPDATE_PERMISSIONS">修改帳號權限設定</option>
                  <option value="DELETE_USER">永久刪除會員帳號</option>
                  <option value="RESET_USER_PASSWORD">執行密碼強制重置</option>
                  <option value="RESET_PASSWORD">後台強制重設密碼</option>
                  <option value="IMPERSONATE">模擬會員登入(一鍵穿越)</option>
                  <option value="IMPERSONATE_USER">以會員身份進入系統</option>
                  <option value="USER_UPDATE">個人檔案自我更新</option>
                  <option value="USER_DELETE">會員自行註銷帳號</option>
                </optgroup>
                <optgroup label="⚙️ 系統設定">
                  <option value="UPDATE_SETTINGS">修改全域系統費率參數</option>
                  <option value="UPDATE_SYSTEM_SETTING">
                    更新單項系統設定值
                  </option>
                  <option value="UPDATE_SYSTEM_SETTINGS">
                    更新全域費率與系統參數
                  </option>
                </optgroup>
              </select>
            </div>
            <button class="btn btn-primary" id="btn-search">
              <i class="fas fa-search"></i> 查詢
            </button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span><i class="fas fa-list"></i> 操作紀錄 (最近 50 筆/頁)</span>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="modern-table">
              <thead>
                <tr>
                  <th style="width: 180px">操作時間</th>
                  <th>操作者</th>
                  <th>動作類型</th>
                  <th>對象 ID</th>
                  <th>詳細說明</th>
                </tr>
              </thead>
              <tbody id="logs-list">
                <tr>
                  <td colspan="5" class="text-center p-4">
                    <i class="fas fa-spinner fa-spin mr-2"></i>資料載入中...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div
          class="card-footer d-flex justify-content-between align-items-center"
        >
          <div id="page-info" class="small text-muted">第 1 / 1 頁</div>
          <div class="btn-group">
            <button class="btn btn-sm btn-outline-secondary" id="btn-prev">
              <i class="fas fa-chevron-left"></i> 上一頁
            </button>
            <button class="btn btn-sm btn-outline-secondary" id="btn-next">
              下一頁 <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="js/apiConfig.js"></script>
    <script src="js/admin-layout.js"></script>
    <script src="js/admin-logs.js"></script>
  </body>
</html>
