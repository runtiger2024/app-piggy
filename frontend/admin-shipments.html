<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>é›†é‹å–®ç®¡ç† - å°è·‘è±¬å¾Œå° 2026</title>
    <link rel="icon" href="assets/logo.png" type="image/png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="css/admin-modern.css" />
    <link rel="stylesheet" href="css/modals-unified.css" />
    <style>
      /* --- [æ ¸å¿ƒä¿®å¾©] è£œä¸Š Modal å®šä½æ¨£å¼ --- */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        z-index: 9999;
        align-items: center;
        justify-content: center;
      }
      .modal-content {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
        max-height: 90vh;
        overflow-y: auto;
      }

      /* --- [å„ªåŒ–] åŒ…è£¹è©³æƒ…è¡¨æ ¼æ¨£å¼ --- */
      .package-detail-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 13px;
      }
      .package-detail-table th {
        background: #f8f9fa;
        padding: 8px;
        border: 1px solid #eee;
        text-align: left;
      }
      .package-detail-table td {
        padding: 8px;
        border: 1px solid #eee;
        vertical-align: middle;
      }
      .pkg-thumb {
        width: 50px;
        height: 50px;
        object-fit: cover;
        border-radius: 4px;
        cursor: pointer;
        border: 1px solid #ddd;
      }
      .box-spec-tag {
        display: inline-block;
        background: #e9ecef;
        padding: 2px 6px;
        border-radius: 3px;
        margin: 2px;
        font-size: 11px;
      }

      .package-list-box {
        border: 1px solid #eee;
        padding: 0;
        background: #fcfcfc;
        border-radius: 6px;
        max-height: 350px; /* åŠ é«˜ä»¥å®¹ç´æ›´å¤šè³‡ä¿¡ */
        overflow-y: auto;
      }

      /* ç‹€æ…‹æ¨™ç±¤ */
      .status-badge {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
      }
      .status-PENDING_PAYMENT {
        background: #fff3e0;
        color: #e65100;
        border: 1px solid #ffb74d;
      }
      .status-AWAITING_REVIEW {
        background: #f3e5f5;
        color: #7b1fa2;
        border: 1px solid #ce93d8;
      } /* å¯©æ ¸ä¸­ */
      .status-PROCESSING {
        background: #e0f7fa;
        color: #006064;
        border: 1px solid #4dd0e1;
      }
      .status-SHIPPED {
        background: #e3f2fd;
        color: #0d47a1;
        border: 1px solid #64b5f6;
      }
      .status-COMPLETED {
        background: #e8f5e9;
        color: #1b5e20;
        border: 1px solid #81c784;
      }
      .status-CANCELLED,
      .status-RETURNED {
        background: #ffebee;
        color: #b71c1c;
        border: 1px solid #ffcdd2;
      }

      /* å¯©æ ¸å€å¡Šå¼·èª¿ */
      .audit-section {
        background: #fff9db;
        border: 2px dashed #fab005;
        padding: 15px;
        border-radius: 8px;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <h1 class="page-title"><i class="fas fa-boxes"></i> é›†é‹å–®ç®¡ç†</h1>

      <div class="card mb-4">
        <div class="card-body">
          <div
            class="filters-bar"
            style="
              display: flex;
              gap: 10px;
              flex-wrap: wrap;
              align-items: center;
            "
          >
            <div style="flex: 1; min-width: 250px">
              <input
                type="text"
                id="search-input"
                class="form-control"
                placeholder="æœå°‹è¨‚å–®è™Ÿ / æœƒå“¡ Email / æ”¶ä»¶äºº / å°ç£å–®è™Ÿ..."
              />
            </div>
            <div style="flex: 0 0 200px">
              <select id="status-filter" class="form-control">
                <option value="">æ‰€æœ‰ç‹€æ…‹</option>
                <option value="AWAITING_REVIEW">å¾…å¯©æ ¸(åˆä½µä¸­)</option>
                <option value="PENDING_PAYMENT">å¾…ä»˜æ¬¾</option>
                <option value="PROCESSING">å·²æ”¶æ¬¾(è™•ç†ä¸­)</option>
                <option value="SHIPPED">å·²è£æ«ƒ</option>
                <option value="CUSTOMS_CHECK">æµ·é—œæŸ¥é©—ä¸­</option>
                <option value="UNSTUFFING">æ‹†æ«ƒæ´¾é€ä¸­</option>
                <option value="COMPLETED">å·²å®Œæˆ</option>
                <option value="RETURNED">è¨‚å–®é€€å›</option>
                <option value="CANCELLED">å·²å–æ¶ˆ</option>
              </select>
            </div>
            <button class="btn btn-primary" id="btn-search">
              <i class="fas fa-search"></i> æœå°‹
            </button>
            <button class="btn btn-outline-secondary" id="btn-export">
              åŒ¯å‡º
            </button>
          </div>
        </div>
      </div>

      <div class="card">
        <div
          class="card-header d-flex justify-content-between align-items-center"
        >
          <div>
            <i class="fas fa-list"></i> è¨‚å–®åˆ—è¡¨
            <span
              id="selected-count"
              class="badge badge-danger ml-2"
              style="display: none"
              >å·²é¸ 0 ç­†</span
            >
          </div>
          <div class="bulk-actions">
            <button
              class="btn btn-sm btn-info"
              id="btn-bulk-process"
              style="display: none"
            >
              <i class="fas fa-check-double"></i> æ‰¹é‡æ”¶æ¬¾
            </button>
            <button
              class="btn btn-sm btn-danger"
              id="btn-bulk-delete"
              style="display: none"
            >
              <i class="fas fa-trash-alt"></i> æ‰¹é‡åˆªé™¤
            </button>
          </div>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="modern-table">
              <thead>
                <tr>
                  <th style="width: 40px">
                    <input type="checkbox" id="select-all" />
                  </th>
                  <th>è¨‚å–®è™Ÿ</th>
                  <th>å»ºç«‹æ™‚é–“</th>
                  <th>æœƒå“¡/æ”¶ä»¶äºº</th>
                  <th>ç¸½é‡‘é¡</th>
                  <th>ç™¼ç¥¨ç‹€æ…‹</th>
                  <th>è¨‚å–®ç‹€æ…‹</th>
                  <th class="text-right">æ“ä½œ</th>
                </tr>
              </thead>
              <tbody id="shipment-list">
                <tr>
                  <td colspan="8" class="text-center p-4">è¼‰å…¥ä¸­...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="card-footer" id="pagination"></div>
      </div>

      <div id="shipment-modal" class="modal">
        <div class="modal-content card" style="width: 900px; max-width: 95%">
          <div class="card-header d-flex justify-content-between">
            <span id="modal-title" class="font-weight-bold"
              ><i class="fas fa-search-plus"></i> é›†é‹å–®æ·±åº¦æª¢é–±</span
            >
            <button
              type="button"
              class="modal-close-btn border-0 bg-transparent"
              style="font-size: 24px"
            >
              &times;
            </button>
          </div>
          <div class="card-body">
            <form id="edit-shipment-form">
              <input type="hidden" id="edit-shipment-id" />

              <div class="info-grid mb-3">
                <div class="info-item">
                  <strong>æ”¶ä»¶äºº:</strong> <span id="m-recipient"></span>
                </div>
                <div class="info-item">
                  <strong>é›»è©±:</strong> <span id="m-phone"></span>
                </div>
                <div class="info-item">
                  <strong>æœƒå“¡å¸³è™Ÿ:</strong> <span id="m-user"></span>
                  <small id="m-piggy-id" class="text-muted ml-2"></small>
                </div>
                <div class="info-item">
                  <strong>èº«åˆ†è­‰/ç¨…è™Ÿ:</strong> <span id="m-id"></span>
                </div>
                <div class="info-item full-width">
                  <strong>é…é€åœ°å€:</strong> <span id="m-address"></span>
                </div>
              </div>

              <div class="mb-3">
                <label class="font-weight-bold text-dark"
                  ><i class="fas fa-cubes"></i> åŒ…å«åŒ…è£¹æ˜ç´° (æ‰“åŒ…å‰è³‡è¨Š)</label
                >
                <div id="m-packages-container" class="package-list-box">
                  <table class="package-detail-table">
                    <thead>
                      <tr>
                        <th>ç…§ç‰‡</th>
                        <th>ç‰©æµå–®è™Ÿ/å“å</th>
                        <th>è³¼è²·é€£çµ</th>
                        <th>å–®ç®±è¦æ ¼ (é•·*å¯¬*é«˜/é‡)</th>
                        <th>é ä¼°è²»ç”¨</th>
                      </tr>
                    </thead>
                    <tbody id="m-packages-list-body"></tbody>
                  </table>
                </div>
              </div>

              <div
                id="audit-action-section"
                class="audit-section mb-3"
                style="display: none"
              >
                <h6 class="font-weight-bold text-warning">
                  <i class="fas fa-gavel"></i> ç®¡ç†å“¡å¯©æ ¸èˆ‡å®šåƒ¹
                </h6>
                <div class="row">
                  <div class="col-md-4">
                    <label>æœ€çµ‚æ ¸å®šé‡‘é¡ (NT$)</label>
                    <input
                      type="number"
                      id="m-audit-cost"
                      class="form-control border-warning"
                      placeholder="è«‹è¼¸å…¥æœ€çµ‚è²»ç”¨"
                    />
                  </div>
                  <div class="col-md-8">
                    <label>å¯©æ ¸å‚™è¨» (å®¢æˆ¶å¯è¦‹)</label>
                    <input
                      type="text"
                      id="m-audit-note"
                      class="form-control border-warning"
                      placeholder="ä¾‹å¦‚ï¼šè¶…æé‡èª¿æ•´ã€æœ¨æ¶è²»å¦è¨ˆ"
                    />
                  </div>
                </div>
                <div class="text-right mt-2">
                  <button
                    type="button"
                    class="btn btn-warning"
                    onclick="window.approveShipment()"
                  >
                    <i class="fas fa-check-circle"></i> å¯©æ ¸é€šéä¸¦è¦æ±‚ä»˜æ¬¾
                  </button>
                </div>
              </div>

              <div class="row mb-3">
                <div class="col-md-6">
                  <div class="section-box border p-2 rounded h-100">
                    <label class="font-weight-bold text-primary"
                      ><i class="fas fa-file-invoice"></i> ç™¼ç¥¨æŠ¬é ­è³‡ä¿¡</label
                    >
                    <div class="row">
                      <div class="col-6">
                        <small>çµ±ä¸€ç·¨è™Ÿ</small>
                        <input
                          type="text"
                          id="m-tax-id"
                          class="form-control form-control-sm"
                        />
                      </div>
                      <div class="col-6">
                        <small>æŠ¬é ­</small>
                        <input
                          type="text"
                          id="m-invoice-title"
                          class="form-control form-control-sm"
                        />
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="section-box border p-2 rounded h-100">
                    <label class="text-info font-weight-bold"
                      ><i class="fas fa-receipt"></i> ä»˜æ¬¾æ†‘è­‰</label
                    >
                    <div
                      id="m-proof"
                      class="text-center p-1 bg-white border"
                      style="min-height: 60px"
                    ></div>
                  </div>
                </div>
              </div>

              <div id="invoice-management-section" class="mb-3"></div>

              <div class="section-box mb-3 bg-light p-3 rounded border">
                <div class="row">
                  <div class="col-md-4">
                    <label>è¨‚å–®ç‹€æ…‹</label>
                    <select id="m-status" class="form-control">
                      <option value="AWAITING_REVIEW">å¾…å¯©æ ¸</option>
                      <option value="PENDING_PAYMENT">å¾…ä»˜æ¬¾</option>
                      <option value="PROCESSING">å·²æ”¶æ¬¾(è™•ç†ä¸­)</option>
                      <option value="SHIPPED">å·²è£æ«ƒ</option>
                      <option value="CUSTOMS_CHECK">æµ·é—œæŸ¥é©—ä¸­</option>
                      <option value="UNSTUFFING">æ‹†æ«ƒæ´¾é€ä¸­</option>
                      <option value="COMPLETED">å·²å®Œæˆ</option>
                      <option value="RETURNED">è¨‚å–®é€€å›</option>
                      <option value="CANCELLED">å·²å–æ¶ˆ</option>
                    </select>
                  </div>
                  <div class="col-md-4">
                    <label>ä¿®æ”¹ç¸½é‡‘é¡ (NT$)</label>
                    <input type="number" id="m-cost" class="form-control" />
                  </div>
                  <div class="col-md-4">
                    <label>å°ç£ç«¯å–®è™Ÿ</label>
                    <input
                      type="text"
                      id="m-tracking-tw"
                      class="form-control"
                      placeholder="é»‘è²“/æ–°ç«¹å–®è™Ÿ"
                    />
                  </div>
                </div>
                <div class="row mt-2">
                  <div class="col-md-6">
                    <label>ğŸš¢ é è¨ˆè£æ«ƒæ—¥æœŸ</label>
                    <input
                      type="date"
                      id="m-loading-date"
                      class="form-control"
                    />
                  </div>
                  <div class="col-md-6">
                    <label>è¨‚å–®ä¸€èˆ¬å‚™è¨»</label>
                    <input type="text" id="m-note" class="form-control" />
                  </div>
                </div>
              </div>

              <div class="modal-footer d-flex justify-content-between">
                <button
                  type="button"
                  id="btn-return-shipment"
                  class="btn btn-outline-danger"
                >
                  <i class="fas fa-undo"></i> é€€å›è¨‚å–®è‡³åŒ…è£¹ç‹€æ…‹
                </button>
                <div class="btn-group">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    onclick="window.printShipment()"
                  >
                    <i class="fas fa-print"></i> åˆ—å°é›†é‹å–®
                  </button>
                  <button type="submit" class="btn btn-success">
                    <i class="fas fa-save"></i> å„²å­˜æ‰€æœ‰æ›´æ–°
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>

      <div id="adjust-price-modal" class="modal">
        <div class="modal-content card" style="width: 450px">
          <div class="card-header bg-warning text-dark">
            <span
              ><i class="fas fa-edit"></i> ä¿®æ­£è¨‚å–®ç¸½é‡‘é¡ (å«éŒ¢åŒ…å¤šé€€å°‘è£œ)</span
            >
            <button
              type="button"
              class="modal-close-btn border-0 bg-transparent"
            >
              &times;
            </button>
          </div>
          <div class="card-body">
            <form id="adjust-price-form">
              <input type="hidden" id="adjust-shipment-id" />
              <div class="form-group mb-3">
                <label>ç›®å‰é‡‘é¡</label>
                <input
                  type="text"
                  id="adjust-original-price"
                  class="form-control"
                  disabled
                />
              </div>
              <div class="form-group mb-3">
                <label class="text-danger">èª¿æ•´å¾Œæ–°é‡‘é¡ (NT$)</label>
                <input
                  type="number"
                  id="adjust-new-price"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group mb-3">
                <label>èª¿æ•´åŸå›  (å®¢æˆ¶èˆ‡æ—¥èªŒå°‡ç•™å­˜)</label>
                <textarea
                  id="adjust-reason"
                  class="form-control"
                  rows="3"
                  required
                ></textarea>
              </div>
              <div class="text-right">
                <button type="button" class="btn btn-light modal-close-btn">
                  å–æ¶ˆ
                </button>
                <button
                  type="button"
                  class="btn btn-primary"
                  onclick="window.confirmAdjustPrice()"
                >
                  ç¢ºèªèª¿æ•´
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script src="js/apiConfig.js"></script>
    <script src="js/admin-layout.js"></script>
    <script src="js/admin-shipments.js"></script>
  </body>
</html>
