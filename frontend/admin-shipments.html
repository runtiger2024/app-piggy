<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>é›†é‹å–®ç®¡ç† - å°è·‘è±¬å¾Œå° 2026</title>
    <link rel="icon" href="assets/logo.png" type="image/png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="css/admin-modern.css" />
    <link rel="stylesheet" href="css/modals-unified.css" />
    <style>
      /* --- [æ ¸å¿ƒä¿®å¾©] è£œä¸Š Modal å®šä½æ¨£å¼ï¼Œç¢ºä¿è¦–çª—èƒ½å‡ºç¾åœ¨è¢å¹•ä¸­å¤® --- */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        z-index: 9999; /* ç¢ºä¿åœ¨æœ€ä¸Šå±¤ */
        align-items: center;
        justify-content: center;
      }
      .modal-content {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
        max-height: 90vh;
        overflow-y: auto;
      }
      .package-list-box {
        border: 1px solid #eee;
        padding: 10px;
        background: #fcfcfc;
        border-radius: 6px;
        max-height: 150px;
        overflow-y: auto;
      }
      /* ç‹€æ…‹æ¨™ç±¤é¡è‰²ä¿æŒä¸è®Š */
      .status-badge {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
      }
      .status-PENDING_PAYMENT {
        background: #fff3e0;
        color: #e65100;
        border: 1px solid #ffb74d;
      }
      .status-PENDING_REVIEW {
        background: #f3e5f5;
        color: #7b1fa2;
        border: 1px solid #ce93d8;
      }
      .status-PROCESSING {
        background: #e0f7fa;
        color: #006064;
        border: 1px solid #4dd0e1;
      }
      .status-SHIPPED {
        background: #e3f2fd;
        color: #0d47a1;
        border: 1px solid #64b5f6;
      }
      .status-COMPLETED {
        background: #e8f5e9;
        color: #1b5e20;
        border: 1px solid #81c784;
      }
      .status-CANCELLED,
      .status-RETURNED {
        background: #ffebee;
        color: #b71c1c;
        border: 1px solid #ffcdd2;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <h1 class="page-title"><i class="fas fa-boxes"></i> é›†é‹å–®ç®¡ç†</h1>

      <div class="card mb-4">
        <div class="card-body">
          <div
            class="filters-bar"
            style="
              display: flex;
              gap: 10px;
              flex-wrap: wrap;
              align-items: center;
            "
          >
            <div style="flex: 1; min-width: 250px">
              <input
                type="text"
                id="search-input"
                class="form-control"
                placeholder="æœå°‹è¨‚å–®è™Ÿ / æœƒå“¡ Email / æ”¶ä»¶äºº..."
              />
            </div>
            <div style="flex: 0 0 200px">
              <select id="status-filter" class="form-control">
                <option value="">æ‰€æœ‰ç‹€æ…‹</option>
                <option value="PENDING_PAYMENT">å¾…ä»˜æ¬¾</option>
                <option value="PENDING_REVIEW">å·²ä»˜æ¬¾(å¾…å¯©æ ¸)</option>
                <option value="PROCESSING">å·²æ”¶æ¬¾(è™•ç†ä¸­)</option>
                <option value="SHIPPED">å·²è£æ«ƒ</option>
                <option value="CUSTOMS_CHECK">æµ·é—œæŸ¥é©—ä¸­</option>
                <option value="UNSTUFFING">æ‹†æ«ƒæ´¾é€ä¸­</option>
                <option value="COMPLETED">å·²å®Œæˆ</option>
                <option value="RETURNED">è¨‚å–®é€€å›</option>
                <option value="CANCELLED">å·²å–æ¶ˆ</option>
              </select>
            </div>
            <button class="btn btn-primary" id="btn-search">
              <i class="fas fa-search"></i> æœå°‹
            </button>
            <button class="btn btn-outline-secondary" id="btn-export">
              åŒ¯å‡º
            </button>
          </div>
        </div>
      </div>

      <div class="card">
        <div
          class="card-header d-flex justify-content-between align-items-center"
        >
          <div>
            <i class="fas fa-list"></i> è¨‚å–®åˆ—è¡¨
            <span
              id="selected-count"
              class="badge badge-danger ml-2"
              style="display: none"
              >å·²é¸ 0 ç­†</span
            >
          </div>
          <div class="bulk-actions">
            <button
              class="btn btn-sm btn-info"
              id="btn-bulk-process"
              style="display: none"
            >
              <i class="fas fa-check-double"></i> æ‰¹é‡æ”¶æ¬¾
            </button>
            <button
              class="btn btn-sm btn-danger"
              id="btn-bulk-delete"
              style="display: none"
            >
              <i class="fas fa-trash-alt"></i> æ‰¹é‡åˆªé™¤
            </button>
          </div>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="modern-table">
              <thead>
                <tr>
                  <th style="width: 40px">
                    <input type="checkbox" id="select-all" />
                  </th>
                  <th>è¨‚å–®è™Ÿ</th>
                  <th>å»ºç«‹æ™‚é–“</th>
                  <th>æœƒå“¡/æ”¶ä»¶äºº</th>
                  <th>ç¸½é‡‘é¡</th>
                  <th>ç™¼ç¥¨ç‹€æ…‹</th>
                  <th>è¨‚å–®ç‹€æ…‹</th>
                  <th class="text-right">æ“ä½œ</th>
                </tr>
              </thead>
              <tbody id="shipment-list">
                <tr>
                  <td colspan="8" class="text-center p-4">è¼‰å…¥ä¸­...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="card-footer" id="pagination"></div>
      </div>

      <div id="shipment-modal" class="modal">
        <div class="modal-content card" style="width: 750px; max-width: 95%">
          <div class="card-header">
            <span id="modal-title">é›†é‹å–®è©³ç´°ç®¡ç†</span>
            <button type="button" class="modal-close-btn">&times;</button>
          </div>
          <div class="card-body">
            <form id="edit-shipment-form">
              <input type="hidden" id="edit-shipment-id" />
              <div class="info-grid mb-3">
                <div class="info-item">
                  <strong>æ”¶ä»¶äºº:</strong> <span id="m-recipient"></span>
                </div>
                <div class="info-item">
                  <strong>é›»è©±:</strong> <span id="m-phone"></span>
                </div>
                <div class="info-item full-width">
                  <strong>åœ°å€:</strong> <span id="m-address"></span>
                </div>
                <div class="info-item">
                  <strong>èº«åˆ†è­‰:</strong> <span id="m-id"></span>
                </div>
                <div class="info-item">
                  <strong>æœƒå“¡:</strong> <span id="m-user"></span>
                </div>
              </div>

              <div class="section-box mb-3 border p-2 rounded">
                <label class="font-weight-bold text-primary"
                  ><i class="fas fa-file-invoice"></i> ç™¼ç¥¨èˆ‡ç¨…å‹™</label
                >
                <div class="row">
                  <div class="col">
                    <small>çµ±ä¸€ç·¨è™Ÿ</small>
                    <input
                      type="text"
                      id="m-tax-id"
                      class="form-control form-control-sm"
                      placeholder="8ç¢¼æ•¸å­—"
                    />
                  </div>
                  <div class="col">
                    <small>ç™¼ç¥¨æŠ¬é ­</small>
                    <input
                      type="text"
                      id="m-invoice-title"
                      class="form-control form-control-sm"
                      placeholder="æŠ¬é ­å…¨éŠœ"
                    />
                  </div>
                </div>
              </div>

              <div class="mb-3">
                <label class="font-weight-bold">ğŸ“¦ åŒ…è£¹å…§å®¹</label>
                <div id="m-packages" class="package-list-box"></div>
              </div>

              <div id="invoice-management-section" class="mb-3"></div>

              <div class="section-box mb-3 bg-light p-3 rounded">
                <div class="row">
                  <div class="col-md-6">
                    <label>è¨‚å–®ç‹€æ…‹</label>
                    <select id="m-status" class="form-control">
                      <option value="PENDING_PAYMENT">å¾…ä»˜æ¬¾</option>
                      <option value="PENDING_REVIEW">å·²ä»˜æ¬¾(å¾…å¯©æ ¸)</option>
                      <option value="PROCESSING">å·²æ”¶æ¬¾(è™•ç†ä¸­)</option>
                      <option value="SHIPPED">å·²è£æ«ƒ</option>
                      <option value="CUSTOMS_CHECK">æµ·é—œæŸ¥é©—ä¸­</option>
                      <option value="UNSTUFFING">æ‹†æ«ƒæ´¾é€ä¸­</option>
                      <option value="COMPLETED">å·²å®Œæˆ</option>
                      <option value="RETURNED">è¨‚å–®é€€å›</option>
                      <option value="CANCELLED">å·²å–æ¶ˆ</option>
                    </select>
                  </div>
                  <div class="col-md-6">
                    <label>ç¸½é‡‘é¡ (NT$)</label>
                    <input type="number" id="m-cost" class="form-control" />
                  </div>
                </div>
                <div class="row mt-2">
                  <div class="col-md-6">
                    <label>å°ç£ç«¯å–®è™Ÿ</label>
                    <input
                      type="text"
                      id="m-tracking-tw"
                      class="form-control"
                    />
                  </div>
                  <div class="col-md-6">
                    <label>ğŸš¢ è£æ«ƒæ—¥æœŸ</label>
                    <input
                      type="date"
                      id="m-loading-date"
                      class="form-control"
                    />
                  </div>
                </div>
              </div>

              <div class="section-box mb-3 border p-2 rounded">
                <label class="text-warning"
                  ><i class="fas fa-image"></i> ä»˜æ¬¾æ†‘è­‰</label
                >
                <div id="m-proof" class="text-center p-2 bg-white border"></div>
              </div>

              <div class="modal-footer d-flex justify-content-between">
                <button
                  type="button"
                  id="btn-return-shipment"
                  class="btn btn-outline-danger"
                >
                  é€€å›è¨‚å–®
                </button>
                <div class="btn-group">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    onclick="window.printShipment()"
                  >
                    åˆ—å°
                  </button>
                  <button type="submit" class="btn btn-success">
                    å„²å­˜æ›´æ–°
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>

      <div id="adjust-price-modal" class="modal">
        <div class="modal-content card" style="width: 450px">
          <div class="card-header bg-warning text-dark">
            <span><i class="fas fa-edit"></i> ä¿®æ”¹è¨‚å–®ç¸½é‡‘é¡</span>
            <button type="button" class="modal-close-btn">&times;</button>
          </div>
          <div class="card-body">
            <form id="adjust-price-form">
              <input type="hidden" id="adjust-shipment-id" />
              <div class="form-group mb-3">
                <label>ç›®å‰é‡‘é¡</label
                ><input
                  type="text"
                  id="adjust-original-price"
                  class="form-control"
                  disabled
                />
              </div>
              <div class="form-group mb-3">
                <label class="text-danger">æ–°é‡‘é¡ (NT$)</label
                ><input
                  type="number"
                  id="adjust-new-price"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group mb-3">
                <label>åŸå› </label
                ><textarea
                  id="adjust-reason"
                  class="form-control"
                  rows="3"
                  required
                ></textarea>
              </div>
              <div class="text-right">
                <button type="button" class="btn btn-light modal-close-btn">
                  å–æ¶ˆ
                </button>
                <button
                  type="button"
                  class="btn btn-primary"
                  onclick="window.confirmAdjustPrice()"
                >
                  ç¢ºèª
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <script src="js/apiConfig.js"></script>
    <script src="js/admin-layout.js"></script>
    <script src="js/admin-shipments.js"></script>
  </body>
</html>
