<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>會員管理 - 小跑豬後台</title>
    <link rel="icon" href="assets/logo.png" type="image/png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="css/admin-modern.css" />
    <link rel="stylesheet" href="css/modals-unified.css" />
    <style>
      /* --- [核心修正] Modal 定位樣式 --- */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 2000; /* 確保高於 SideBar */
        align-items: center;
        justify-content: center;
      }
      .modal-card {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        max-height: 90vh;
        overflow-y: auto;
      }
      .perm-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
        background: #f8f9fc;
        padding: 12px;
        border-radius: 8px;
        margin-top: 10px;
      }
      /* 優化表格內的微小文字樣式 */
      .info-subtext {
        font-size: 0.85rem;
        color: #6c757d;
        display: block;
        margin-top: 2px;
      }
      .address-cell {
        max-width: 180px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        font-size: 0.85rem;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <h1 class="page-title">會員帳號管理</h1>

      <div class="card">
        <div class="card-body">
          <div class="filters-bar" style="margin-bottom: 0">
            <div style="flex: 1; min-width: 250px">
              <input
                type="text"
                id="search-input"
                class="form-control"
                placeholder="搜尋姓名 / Email / 電話 / 會員代碼..."
              />
            </div>
            <div style="flex: 0 0 180px">
              <select id="role-filter" class="form-control">
                <option value="">所有角色</option>
                <option value="USER">一般會員 (User)</option>
                <option value="ADMIN">管理員 (Admin)</option>
                <option value="OPERATOR">操作員 (Operator)</option>
              </select>
            </div>
            <div style="flex: 0 0 150px">
              <select id="status-filter" class="form-control">
                <option value="">所有狀態</option>
                <option value="true">啟用中</option>
                <option value="false">已停用</option>
              </select>
            </div>
            <button class="btn btn-primary" id="btn-search">
              <i class="fas fa-search"></i> 搜尋
            </button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span><i class="fas fa-users"></i> 會員名單</span>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="modern-table">
              <thead>
                <tr>
                  <th>會員資訊 (代碼/姓名)</th>
                  <th>聯絡資訊 (Email/電話)</th>
                  <th>預設收貨地址</th>
                  <th>資信摘要 (餘額/統編)</th>
                  <th>角色權限</th>
                  <th>註冊日期</th>
                  <th>狀態</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="members-list">
                <tr>
                  <td colspan="8" class="text-center p-4">資料載入中...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div
          class="card-body border-top"
          id="pagination"
          style="display: flex; justify-content: flex-end; gap: 5px"
        ></div>
      </div>

      <div id="member-modal" class="modal">
        <div class="modal-card card" style="width: 600px; max-width: 95%">
          <div class="card-header d-flex justify-content-between">
            <span id="modal-title">編輯會員資料</span>
            <button type="button" class="btn btn-sm btn-danger modal-close-btn">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="card-body">
            <form id="member-form">
              <input type="hidden" id="edit-user-id" />

              <div
                style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px"
                class="mb-3"
              >
                <div class="form-group">
                  <label>Email (帳號)</label>
                  <input
                    type="email"
                    id="m-email"
                    class="form-control"
                    disabled
                    style="background-color: #f0f0f0"
                  />
                </div>
                <div class="form-group">
                  <label class="text-primary font-weight-bold"
                    >會員專屬代碼</label
                  >
                  <input
                    type="text"
                    id="m-piggyId"
                    class="form-control"
                    placeholder="系統自動分配"
                  />
                </div>
              </div>

              <div
                style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px"
              >
                <div class="form-group">
                  <label>姓名</label>
                  <input type="text" id="m-name" class="form-control" />
                </div>
                <div class="form-group">
                  <label>電話</label>
                  <input type="text" id="m-phone" class="form-control" />
                </div>
              </div>

              <div class="form-group mb-3 mt-3">
                <label>預設收件地址</label>
                <textarea
                  id="m-address"
                  class="form-control"
                  rows="2"
                  placeholder="客戶常用的收貨地址"
                ></textarea>
              </div>

              <div
                style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px"
                class="mb-3"
              >
                <div class="form-group">
                  <label>發票抬頭</label>
                  <input type="text" id="m-invoiceTitle" class="form-control" />
                </div>
                <div class="form-group">
                  <label>統一編號</label>
                  <input type="text" id="m-taxId" class="form-control" />
                </div>
              </div>

              <hr />
              <div class="form-group mb-3">
                <label class="font-weight-bold text-primary"
                  >後台權限設定</label
                >
                <div class="perm-grid">
                  <div>
                    <input
                      type="checkbox"
                      class="perm-check"
                      value="CAN_VIEW_DASHBOARD"
                    />
                    查看儀表板
                  </div>
                  <div>
                    <input
                      type="checkbox"
                      class="perm-check"
                      value="CAN_VIEW_LOGS"
                    />
                    查看日誌
                  </div>
                  <div>
                    <input
                      type="checkbox"
                      class="perm-check"
                      value="CAN_MANAGE_PACKAGES"
                    />
                    管理包裹
                  </div>
                  <div>
                    <input
                      type="checkbox"
                      class="perm-check"
                      value="CAN_MANAGE_SHIPMENTS"
                    />
                    管理訂單
                  </div>
                  <div>
                    <input
                      type="checkbox"
                      class="perm-check"
                      value="CAN_MANAGE_USERS"
                    />
                    管理會員 (Admin)
                  </div>
                  <div>
                    <input
                      type="checkbox"
                      class="perm-check"
                      value="CAN_MANAGE_SYSTEM"
                    />
                    系統設定 (System)
                  </div>
                </div>
              </div>
              <hr />
              <div style="display: flex; gap: 10px; flex-wrap: wrap">
                <button
                  type="button"
                  id="btn-reset-pwd"
                  class="btn btn-warning flex-1"
                >
                  <i class="fas fa-key"></i> 重設密碼 (8888)
                </button>
                <button
                  type="button"
                  id="btn-impersonate"
                  class="btn btn-info flex-1 text-white"
                >
                  <i class="fas fa-user-secret"></i> 模擬登入
                </button>
              </div>
              <div style="text-align: right; margin-top: 20px">
                <button type="submit" class="btn btn-primary px-4">
                  儲存變更
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <script src="js/apiConfig.js"></script>
    <script src="js/admin-layout.js"></script>
    <script src="js/admin-members.js"></script>
  </body>
</html>
