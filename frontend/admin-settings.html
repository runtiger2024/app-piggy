<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <title>系統設定 - 小跑豬後台</title>
    <link rel="icon" href="assets/logo.png" type="image/png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="css/admin-modern.css" />
    <link rel="stylesheet" href="css/modals-unified.css" />
    <style>
      .settings-tab-nav {
        display: flex;
        background: white;
        border-bottom: 1px solid #e3e6f0;
        padding: 0 20px;
        overflow-x: auto;
        scrollbar-width: none; /* Firefox */
      }
      .settings-tab-nav::-webkit-scrollbar {
        display: none;
      } /* Chrome */

      .tab-btn {
        padding: 15px 25px;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        color: #858796;
        font-weight: 600;
        transition: 0.2s;
        white-space: nowrap;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .tab-btn:hover {
        color: #4e73df;
      }
      .tab-btn.active {
        color: #4e73df;
        border-bottom-color: #4e73df;
      }
      .tab-content {
        display: none;
        padding: 20px;
        animation: fadeIn 0.3s ease;
      }
      .tab-content.active {
        display: block;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(5px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .btn-remove-cat {
        color: #e74a3b;
        cursor: pointer;
        transition: 0.2s;
      }
      .btn-remove-cat:hover {
        color: #c0392b;
        transform: scale(1.1);
      }
      /* 偏遠地區區塊樣式 */
      .remote-block {
        border-left: 4px solid #36b9cc;
        background: #fff;
        margin-bottom: 15px;
      }
      .remote-header {
        background: #f8f9fc;
        padding: 10px 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #e3e6f0;
      }
      /* 附加服務管理卡片優化 */
      .service-block.card {
        border: none;
        box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1);
        transition: transform 0.2s, box-shadow 0.2s;
        border-radius: 12px;
        overflow: hidden;
      }

      .service-block.card:hover {
        transform: translateY(-3px);
        box-shadow: 0 0.5rem 2rem 0 rgba(58, 59, 69, 0.15);
      }

      .service-block .card-body {
        padding: 1.25rem;
      }

      .service-status-active {
        border-left: 6px solid #1cc88a !important;
      }

      .service-status-inactive {
        border-left: 6px solid #858796 !important;
        opacity: 0.8;
      }

      .svc-input-group label {
        font-weight: 700;
        color: #4e73df;
        margin-bottom: 0.4rem;
        font-size: 0.85rem;
      }

      /* 核心優化：讓表格按鈕組固定寬度，防止排版跳動 */
      .btn-action-group {
        display: flex;
        gap: 8px;
        justify-content: flex-end;
        min-width: 100px;
      }

      /* 核心優化：強化彈窗字體配色與間距 */
      .modal-body label {
        font-weight: 700;
        color: #475569 !important; /* 深灰色確保清晰度 */
        margin-bottom: 0.5rem;
        display: block;
        font-size: 0.9rem;
      }

      .modal-body .form-control {
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        padding: 10px 15px;
        transition: all 0.2s ease;
        color: #1e293b;
      }

      .modal-body .form-control:focus {
        border-color: #4e73df;
        box-shadow: 0 0 0 4px rgba(78, 115, 223, 0.1);
        background-color: #fff;
      }

      /* CMS 標籤樣式優化 */
      .badge-status {
        font-weight: 700;
        padding: 0.35em 0.8em;
        border-radius: 50px;
        font-size: 11px;
        display: inline-block;
      }
      .tag-system {
        background: #e0f2fe;
        color: #0369a1;
        border: 1px solid #bae6fd;
      }
      .tag-promotion {
        background: #dcfce7;
        color: #15803d;
        border: 1px solid #bbf7d0;
      }
      .tag-holiday {
        background: #fef3c7;
        color: #92400e;
        border: 1px solid #fde68a;
      }
      .tag-general {
        background: #f1f5f9;
        color: #475569;
        border: 1px solid #e2e8f0;
      }
      .badge-important {
        background: #fee2e2;
        color: #b91c1c;
        border: 1px solid #fecaca;
      }
      .badge-success {
        background: #dcfce7;
        color: #15803d;
      }
      .badge-secondary {
        background: #f1f5f9;
        color: #475569;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <h1 class="page-title">系統全域設定與內容管理</h1>

      <div class="card">
        <div class="settings-tab-nav">
          <div class="tab-btn active" data-tab="tab-rates">
            <i class="fas fa-calculator"></i> 運費費率
          </div>
          <div class="tab-btn" data-tab="tab-services">
            <i class="fas fa-concierge-bell"></i> 附加服務
          </div>
          <div class="tab-btn" data-tab="tab-remote">
            <i class="fas fa-map-marked-alt"></i> 偏遠地區
          </div>
          <div class="tab-btn" data-tab="tab-furniture">
            <i class="fas fa-couch"></i> 傢俱代採購
          </div>
          <div class="tab-btn" data-tab="tab-news">
            <i class="fas fa-bullhorn"></i> 最新消息
          </div>
          <div class="tab-btn" data-tab="tab-faq">
            <i class="fas fa-question-circle"></i> 常見問題
          </div>
          <div class="tab-btn" data-tab="tab-about">
            <i class="fas fa-info-circle"></i> 關於我們
          </div>
          <div class="tab-btn" data-tab="tab-sys">
            <i class="fas fa-cog"></i> 系統公告
          </div>
          <div class="tab-btn" data-tab="tab-bank">
            <i class="fas fa-university"></i> 銀行資訊
          </div>
          <div class="tab-btn" data-tab="tab-invoice">
            <i class="fas fa-file-invoice"></i> 電子發票
          </div>
          <div class="tab-btn" data-tab="tab-email">
            <i class="fas fa-envelope"></i> 郵件通知
          </div>
        </div>

        <div id="tab-rates" class="tab-content active">
          <form id="form-rates">
            <h5 class="text-primary font-weight-bold mb-3">
              全域運算常數 (Constants)
            </h5>
            <div
              style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
                margin-bottom: 20px;
              "
            >
              <div>
                <label>海運低消 (NT$)</label>
                <input
                  type="number"
                  id="const-MINIMUM_CHARGE"
                  class="form-control"
                  required
                />
              </div>
              <div>
                <label>材積換算係數 (Divisor)</label>
                <input
                  type="number"
                  id="const-VOLUME_DIVISOR"
                  class="form-control"
                  required
                />
              </div>
              <div>
                <label>CBM 轉材積係數</label>
                <input
                  type="number"
                  step="0.1"
                  id="const-CBM_TO_CAI_FACTOR"
                  class="form-control"
                />
              </div>
              <div>
                <label>超長限制 (cm)</label>
                <input
                  type="number"
                  id="const-OVERSIZED_LIMIT"
                  class="form-control"
                />
              </div>
              <div>
                <label>超長附加費 ($)</label>
                <input
                  type="number"
                  id="const-OVERSIZED_FEE"
                  class="form-control"
                />
              </div>
              <div>
                <label>超重限制 (kg)</label>
                <input
                  type="number"
                  id="const-OVERWEIGHT_LIMIT"
                  class="form-control"
                />
              </div>
              <div>
                <label>超重附加費 ($)</label>
                <input
                  type="number"
                  id="const-OVERWEIGHT_FEE"
                  class="form-control"
                />
              </div>
            </div>
            <hr class="my-4" />
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 15px;
              "
            >
              <h5 class="text-primary font-weight-bold mb-0">
                家具類別費率 (Categories)
              </h5>
            </div>
            <div id="categories-container"></div>
            <button
              type="button"
              id="btn-add-category"
              class="btn btn-outline-primary btn-sm mb-4"
              style="border-style: dashed"
            >
              <i class="fas fa-plus"></i> 新增類別
            </button>
            <div style="text-align: right">
              <button type="submit" class="btn btn-success btn-lg">
                <i class="fas fa-save"></i> 儲存所有費率設定
              </button>
            </div>
          </form>
        </div>

        <div id="tab-services" class="tab-content">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 20px;
            "
          >
            <h5 class="text-primary font-weight-bold mb-0">附加服務管理</h5>
            <button
              type="button"
              id="btn-add-service"
              class="btn btn-primary btn-sm"
            >
              <i class="fas fa-plus"></i> 新增服務項目
            </button>
          </div>
          <div class="table-responsive">
            <table class="table table-bordered table-hover">
              <thead class="thead-light">
                <tr>
                  <th>服務名稱</th>
                  <th>描述</th>
                  <th>單價 (TWD)</th>
                  <th>單位</th>
                  <th>狀態</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="services-container"></tbody>
            </table>
          </div>
        </div>

        <div id="tab-remote" class="tab-content">
          <form id="form-remote">
            <div class="alert alert-info">
              <i class="fas fa-info-circle"></i>
              設定偏遠地區加收費用。系統會比對地址關鍵字。
            </div>
            <div id="remote-container"></div>
            <button
              type="button"
              id="btn-add-remote"
              class="btn btn-outline-info btn-sm mb-4"
              style="border-style: dashed"
            >
              <i class="fas fa-plus"></i> 新增費率區間
            </button>
            <div style="text-align: right">
              <button type="submit" class="btn btn-info btn-lg">
                <i class="fas fa-map-marked-alt"></i> 儲存偏遠地區設定
              </button>
            </div>
          </form>
        </div>

        <div id="tab-furniture" class="tab-content">
          <form id="form-furniture">
            <div class="form-group mb-3">
              <label class="font-weight-bold"
                >代採購人民幣匯率 (1 RMB = ? TWD)</label
              >
              <input
                type="number"
                step="0.0001"
                id="fur-exchange-rate"
                class="form-control"
                required
              />
            </div>
            <div class="form-group mb-3">
              <label class="font-weight-bold">代採購服務費率 (%)</label>
              <input
                type="number"
                step="0.1"
                id="fur-service-fee-rate"
                class="form-control"
                required
              />
            </div>
            <div class="form-group mb-4">
              <label class="font-weight-bold">最低服務費 (TWD)</label>
              <input
                type="number"
                id="fur-min-service-fee"
                class="form-control"
              />
            </div>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save"></i> 儲存代採購設定
            </button>
          </form>
        </div>

        <div id="tab-news" class="tab-content">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 20px;
            "
          >
            <h5 class="text-primary font-weight-bold mb-0">最新消息管理</h5>
            <button
              type="button"
              class="btn btn-primary btn-sm"
              onclick="openNewsModal()"
            >
              <i class="fas fa-plus"></i> 發布新公告
            </button>
          </div>
          <div class="table-responsive">
            <table class="table table-bordered table-hover">
              <thead class="thead-light">
                <tr>
                  <th style="width: 80px">狀態</th>
                  <th style="width: 120px">分類</th>
                  <th>標題</th>
                  <th style="width: 100px">重要性</th>
                  <th style="width: 120px">日期</th>
                  <th style="width: 120px">操作</th>
                </tr>
              </thead>
              <tbody id="admin-news-container"></tbody>
            </table>
          </div>
        </div>

        <div id="tab-faq" class="tab-content">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 20px;
            "
          >
            <h5 class="text-primary font-weight-bold mb-0">
              常見問題管理 (FAQ)
            </h5>
            <button
              type="button"
              class="btn btn-primary btn-sm"
              onclick="openFaqModal()"
            >
              <i class="fas fa-plus"></i> 新增 Q&A
            </button>
          </div>
          <div class="table-responsive">
            <table class="table table-bordered table-hover">
              <thead class="thead-light">
                <tr>
                  <th style="width: 80px">排序</th>
                  <th style="width: 120px">分類</th>
                  <th>問題</th>
                  <th style="width: 100px">狀態</th>
                  <th style="width: 120px">操作</th>
                </tr>
              </thead>
              <tbody id="admin-faq-container"></tbody>
            </table>
          </div>
        </div>

        <div id="tab-about" class="tab-content">
          <form id="form-admin-about">
            <div class="alert alert-info">
              <i class="fas fa-info-circle"></i>
              此處編輯的內容將即時顯示於客戶端的「關於我們」分頁。支援 HTML
              標籤。
            </div>
            <div class="form-group mb-3">
              <label class="font-weight-bold">頁面標題</label>
              <input
                type="text"
                id="about-title"
                class="form-control"
                placeholder="例如：關於小跑豬家具專線"
              />
            </div>
            <div class="form-group mb-4">
              <label class="font-weight-bold">詳細內容介紹 (HTML 支援)</label>
              <textarea
                id="about-content"
                class="form-control"
                rows="15"
                placeholder="請輸入詳細的服務介紹與公司理念..."
              ></textarea>
            </div>
            <div style="text-align: right">
              <button type="submit" class="btn btn-primary btn-lg">
                <i class="fas fa-save"></i> 儲存關於我們內容
              </button>
            </div>
          </form>
        </div>

        <div id="tab-sys" class="tab-content">
          <form id="form-announcement">
            <div class="form-group mb-3">
              <label class="font-weight-bold">前台頂部捲軸公告 (跑馬燈)</label>
              <textarea id="ann-text" class="form-control" rows="3"></textarea>
            </div>
            <div class="form-group mb-3">
              <label>公告顏色樣式</label>
              <select id="ann-color" class="form-control">
                <option value="info">藍色 (資訊)</option>
                <option value="warning">橘色 (警告)</option>
                <option value="danger">紅色 (緊急)</option>
                <option value="success">綠色 (正常)</option>
              </select>
            </div>
            <div class="form-check mb-4">
              <input type="checkbox" id="ann-enabled" />
              <label for="ann-enabled" class="ml-2">啟用公告顯示</label>
            </div>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-bullhorn"></i> 更新全域公告
            </button>
          </form>
        </div>

        <div id="tab-bank" class="tab-content">
          <form id="form-bank">
            <div class="form-group mb-3">
              <label>銀行名稱 (含代碼)</label>
              <input type="text" id="bank-name" class="form-control" />
            </div>
            <div class="form-group mb-3">
              <label>分行名稱</label>
              <input type="text" id="bank-branch" class="form-control" />
            </div>
            <div class="form-group mb-3">
              <label>銀行帳號</label>
              <input
                type="text"
                id="bank-account"
                class="form-control"
                style="font-family: monospace"
              />
            </div>
            <div class="form-group mb-4">
              <label>戶名</label>
              <input type="text" id="bank-holder" class="form-control" />
            </div>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-university"></i> 更新匯款資料
            </button>
          </form>
        </div>

        <div id="tab-invoice" class="tab-content">
          <form id="form-invoice">
            <div class="form-check mb-3">
              <input type="checkbox" id="inv-enabled" />
              <label for="inv-enabled" class="ml-2">啟用電子發票</label>
            </div>
            <div class="form-group mb-3">
              <label>Merchant ID (商店編號)</label>
              <input type="text" id="inv-merchant-id" class="form-control" />
            </div>
            <div class="form-group mb-3">
              <label>Hash Key / API Key</label>
              <input
                type="password"
                id="inv-hash-key"
                class="form-control"
                placeholder="請輸入金流或發票介接密鑰"
              />
            </div>
            <div class="form-group mb-3">
              <label>營運模式</label>
              <select id="inv-mode" class="form-control">
                <option value="test">測試環境 (SandBox)</option>
                <option value="prod">正式營運 (Production)</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary">儲存發票設定</button>
          </form>
        </div>

        <div id="tab-email" class="tab-content">
          <form id="form-email">
            <div class="form-group mb-3">
              <label>寄件者名稱</label>
              <input type="text" id="email-sender-name" class="form-control" />
            </div>
            <div class="form-group mb-3">
              <label>寄件者 Email</label>
              <input type="email" id="email-sender-addr" class="form-control" />
            </div>
            <div class="form-group mb-3">
              <label>系統通知收件者 (多個 Email 請用逗號隔開)</label>
              <textarea
                id="email-recipients"
                class="form-control"
                rows="2"
                placeholder="admin@example.com, manager@example.com"
              ></textarea>
            </div>
            <button type="submit" class="btn btn-primary">更新郵件設定</button>
          </form>
        </div>

        <div id="modal-news" class="modal-overlay" style="display: none">
          <div
            class="modal-container"
            style="max-width: 750px; border-radius: 20px"
          >
            <div class="modal-header">
              <h3 id="news-modal-title">
                <i class="fas fa-edit mr-2"></i>發布新公告
              </h3>
              <span class="modal-close" onclick="closeNewsModal()"
                >&times;</span
              >
            </div>
            <div class="modal-body" style="padding: 30px">
              <form id="form-news-item">
                <input type="hidden" id="news-id" />
                <div class="form-group mb-4">
                  <label>公告標題 <span class="text-danger">*</span></label>
                  <input
                    type="text"
                    id="news-title-input"
                    class="form-control"
                    placeholder="請輸入吸睛的公告標題..."
                    required
                  />
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group mb-4">
                      <label>顯示分類</label>
                      <select id="news-category" class="form-control">
                        <option value="GENERAL">一般公告</option>
                        <option value="SYSTEM">系統通知</option>
                        <option value="PROMOTION">優惠活動</option>
                        <option value="HOLIDAY">節假日安排</option>
                      </select>
                    </div>
                  </div>
                  <div
                    class="col-md-6 d-flex align-items-center justify-content-around"
                    style="padding-top: 10px"
                  >
                    <div class="custom-control custom-checkbox">
                      <input
                        type="checkbox"
                        class="custom-control-input"
                        id="news-important"
                      />
                      <label
                        class="custom-control-label font-weight-bold text-danger"
                        for="news-important"
                        >標記重要</label
                      >
                    </div>
                    <div class="custom-control custom-switch">
                      <input
                        type="checkbox"
                        class="custom-control-input"
                        id="news-published"
                        checked
                      />
                      <label class="custom-control-label" for="news-published"
                        >立即發布</label
                      >
                    </div>
                  </div>
                </div>
                <div class="form-group mb-4">
                  <label>詳細內容</label>
                  <textarea
                    id="news-content-input"
                    class="form-control"
                    rows="8"
                    placeholder="輸入公告的詳細說明內容..."
                  ></textarea>
                </div>
                <div class="modal-footer px-0 pb-0">
                  <button
                    type="submit"
                    class="btn btn-primary btn-block btn-lg"
                    style="border-radius: 12px"
                  >
                    <i class="fas fa-save mr-2"></i>儲存並更新公告內容
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <div id="modal-faq" class="modal-overlay" style="display: none">
          <div
            class="modal-container"
            style="max-width: 700px; border-radius: 20px"
          >
            <div class="modal-header">
              <h3 id="faq-modal-title">
                <i class="fas fa-question-circle mr-2"></i>編輯常見問題
              </h3>
              <span class="modal-close" onclick="closeFaqModal()">&times;</span>
            </div>
            <div class="modal-body" style="padding: 30px">
              <form id="form-faq-item">
                <input type="hidden" id="faq-id" />
                <div class="form-group mb-4">
                  <label
                    >問題 (Question) <span class="text-danger">*</span></label
                  >
                  <input
                    type="text"
                    id="faq-question-input"
                    class="form-control"
                    placeholder="請輸入客戶常問的問題..."
                    required
                  />
                </div>
                <div class="form-group mb-4">
                  <label
                    >回答 (Answer) <span class="text-danger">*</span></label
                  >
                  <textarea
                    id="faq-answer-input"
                    class="form-control"
                    rows="6"
                    placeholder="請輸入詳細的解答內容..."
                    required
                  ></textarea>
                </div>
                <div class="row">
                  <div class="col-md-4">
                    <div class="form-group mb-4">
                      <label>顯示分類</label>
                      <select id="faq-category" class="form-control">
                        <option value="LOGISTICS">物流轉運</option>
                        <option value="PAYMENT">費用帳務</option>
                        <option value="CUSTOMS">報關查驗</option>
                        <option value="ACCOUNT">帳號功能</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-group mb-4">
                      <label>排序權重</label>
                      <input
                        type="number"
                        id="faq-order"
                        class="form-control"
                        value="0"
                      />
                    </div>
                  </div>
                  <div
                    class="col-md-4 d-flex align-items-center justify-content-center"
                    style="padding-top: 10px"
                  >
                    <div class="custom-control custom-switch">
                      <input
                        type="checkbox"
                        class="custom-control-input"
                        id="faq-active"
                        checked
                      />
                      <label
                        class="custom-control-label font-weight-bold"
                        for="faq-active"
                        >啟用顯示</label
                      >
                    </div>
                  </div>
                </div>
                <div class="modal-footer px-0 pb-0">
                  <button
                    type="submit"
                    class="btn btn-primary btn-block btn-lg"
                    style="border-radius: 12px"
                  >
                    <i class="fas fa-save mr-2"></i>儲存問答項目
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <div id="modal-service" class="modal-overlay" style="display: none">
          <div class="modal-container" style="max-width: 500px">
            <div class="modal-header">
              <h3 id="service-modal-title">附加服務詳情</h3>
              <span class="modal-close" id="btn-close-service-modal"
                >&times;</span
              >
            </div>
            <div class="modal-body">
              <form id="form-service-item">
                <input type="hidden" id="service-id" />
                <div class="form-group mb-3">
                  <label>服務名稱 *</label>
                  <input
                    type="text"
                    id="service-name"
                    class="form-control"
                    required
                  />
                </div>
                <div class="form-group mb-3">
                  <label>描述</label>
                  <textarea
                    id="service-desc"
                    class="form-control"
                    rows="2"
                  ></textarea>
                </div>
                <div class="form-group mb-3">
                  <label>單價 (TWD) *</label>
                  <input
                    type="number"
                    id="service-price"
                    class="form-control"
                    value="0"
                    required
                  />
                </div>
                <div class="form-group mb-3">
                  <label>計費單位</label>
                  <select id="service-unit" class="form-control">
                    <option value="PIECE">按件計費 (PIECE)</option>
                    <option value="WEIGHT">按重量計費 (WEIGHT)</option>
                    <option value="SHIPMENT">按單計費 (SHIPMENT)</option>
                  </select>
                </div>
                <div class="form-check mb-4">
                  <input type="checkbox" id="service-active" checked />
                  <label for="service-active" class="ml-2">啟用服務</label>
                </div>
                <button type="submit" class="btn btn-primary btn-block">
                  儲存服務項目
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="js/apiConfig.js"></script>
    <script src="js/admin-layout.js"></script>
    <script src="js/admin-settings.js"></script>
    <script src="js/admin-content.js"></script>
  </body>
</html>
